<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>User profile</title>
	</head>
	<body>
		<h1>This is profile</h1>
		<h2 id="fn">yr fn is: </h2>
		<img id="image"/>
		<button onclick="logout()">Logout</button>
		<script type="text/javascript">
			let params = {}
			let regex = /([^&=]+)=([^&]*)/g, m
			while(m = regex.exec(location.href)){
				params[decodeURIComponent(m[1])]=decodeURIComponent(m[2])
			}
			if(Object.keys(params).length > 0){
				localStorage.setItem('authInfo',JSON.stringify(params))
			}
			window.history.pushState({},document.title,"/profile")
			let info = JSON.parse(localStorage.getItem('authInfo'))
			console.log(info)
			let headers = new Headers();
			headers.append("Autherization",`Bearer ${(info['access_token'])}`);
			headers.append('Content-Type', 'application/json');
			headers.append('Accept', 'application/json');
			headers.append('Origin','https://oniechat.netlify.app');

			fetch("https://www.googleapis.com/oauth2/v3/userinfo", {
				mode: 'no-cors',
				credentials: 'include',
				method: 'GET',
				headers: headers
			}).then((data)=>data.json()).then((info)=> {
				console.log(info)
				document.getElementById("fn").innerHTML+= info.name
				document.getElementById("Image").setAttribute('src',info.picture)
			})
			function logout(){
			}
		</script>
	</body>
</html>
